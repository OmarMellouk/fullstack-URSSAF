import { InjectionToken } from '@angular/core';
// Token permettant d'injecter le success_handler
export const PRISME_SUCCESS_LOGIN_HANDLER = new InjectionToken('PRISME_SUCCESS_LOGIN_HANDLER');
// Token permettant d'injecter le success_handler
export const PRISME_FAILURE_LOGIN_HANDLER = new InjectionToken('PRISME_FAILURE_LOGIN_HANDLER');
// Classe permettant de travailler sur les paramètres fournie par l'application afin d'ajouter du comportement
// Cette classe est la configuration "interne" de la librairie prisme
// A la constrcution on copie l'ensemble des paramètres écrits dans la configuration de l'application appelante dans cette classe
// @Injectable({
//   providedIn: 'root'
// })
export class PrismeAngularConfiguration {
    constructor(appconf) {
        this.appconf = appconf;
        // Si appConf n'est pas null, alors on contruit la configuration a partir de appConf
        // Sinon, la classe appelante doit fournir les informations "une à une"
        if (appconf) {
            // Vérification des urls des Enpoints et affectation des endpoints à partir de prismeUrlBaseEndpoints (si )
            this.setPrismeEndpoints(appconf);
            this.prismeIss = this.appconf.prismeIss;
            this.prismeScopeBack = this.appconf.prismeScopeBack;
            this.prismeClientSecret = this.appconf.prismeClientSecret;
            this.prismeClientId = this.appconf.prismeClientId;
            this.prismeCodeApp = this.appconf.prismeCodeApp;
            this.prismeScopeFront = this.appconf.prismeScopeFront;
            this.applicationUri = this.addHttpIsNecessary(this.appconf.applicationUri);
            this.prismeRefreshTokensInterval = this.appconf.prismeRefreshTokensInterval;
            this.iFrameRenouvellement = this.appconf.iFrameRenouvellement;
            this.pageApresConnexion = this.appconf.pageApresConnexion;
            this.chargerUserInfosBack = this.appconf.chargerUserInfosBack;
            this.chargerUserInfosFront = this.appconf.chargerUserInfosFront;
            this.jetonReadyTopic = this.appconf.jetonReadyTopic;
            this.jetonMessageTopic = this.appconf.jetonMessageTopic;
            this.waitWebMessageURLFragment = this.appconf.waitWebMessageURLFragment;
        }
    }
    replaceIfNull(parameterToTest, replaceBy) {
        if (parameterToTest == null) {
            return replaceBy;
        }
        else {
            return parameterToTest;
        }
    }
    addHttpIsNecessary(parameterToTest) {
        if (parameterToTest.startsWith('http')) {
            return parameterToTest;
        }
        else {
            return 'http://' + parameterToTest;
        }
    }
    /**
     * Affecte les endPoints à partir de prismeUrlBaseEndpoint
     * Vérifie si les valeurs sont bien affectées
     * @param length Longueur
     */
    setPrismeEndpoints(conf) {
        if (conf.prismeUrlBaseEndpoint != null) {
            this.prismeUrlBaseEndpoint = conf.prismeUrlBaseEndpoint;
            // On enleve le / a la fin si il est présent
            if (this.prismeUrlBaseEndpoint.endsWith('/')) {
                this.prismeUrlBaseEndpoint = this.prismeUrlBaseEndpoint.slice(0, this.prismeUrlBaseEndpoint.length - 1);
            }
            this.prismeAuthzEndpoint = this.replaceIfNull(conf.prismeAuthzEndpoint, this.prismeUrlBaseEndpoint + '/security/v1/pss/authz');
            this.prismeTokenEndpoint = this.replaceIfNull(conf.prismeTokenEndpoint, this.prismeUrlBaseEndpoint + '/security/v1/pss/token');
            this.prismeKeysEndpoint = this.replaceIfNull(conf.prismeKeysEndpoint, this.prismeUrlBaseEndpoint + '/security/v1/pss/jwks/public');
            this.prismeUserEndpoint = this.replaceIfNull(conf.prismeUserEndpoint, this.prismeUrlBaseEndpoint + '/security/v1/pss/user-info');
        }
        else {
            this.prismeAuthzEndpoint = conf.prismeAuthzEndpoint;
            this.prismeTokenEndpoint = conf.prismeTokenEndpoint;
            this.prismeKeysEndpoint = conf.prismeKeysEndpoint;
            this.prismeUserEndpoint = conf.prismeUserEndpoint;
        }
        // On remplace les // par des / car pose problème
        this.prismeAuthzEndpoint = this.prismeAuthzEndpoint.replace(/([^:]\/)\/+/g, '$1');
        this.prismeTokenEndpoint = this.prismeTokenEndpoint.replace(/([^:]\/)\/+/g, '$1');
        this.prismeKeysEndpoint = this.prismeKeysEndpoint.replace(/([^:]\/)\/+/g, '$1');
        this.prismeUserEndpoint = this.prismeUserEndpoint.replace(/([^:]\/)\/+/g, '$1');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpc21lLWFuZ3VsYXIuY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYWNvc3MvcHJpc21lLWFuZ3VsYXItaW50cmFuZXQvc3JjL2xpYi9wcmlzbWUtYW5ndWxhci5jb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU0vQyxpREFBaUQ7QUFDakQsTUFBTSxDQUFDLE1BQU0sNEJBQTRCLEdBQUcsSUFBSSxjQUFjLENBQThCLDhCQUE4QixDQUFDLENBQUM7QUFFNUgsaURBQWlEO0FBQ2pELE1BQU0sQ0FBQyxNQUFNLDRCQUE0QixHQUFHLElBQUksY0FBYyxDQUErQiw4QkFBOEIsQ0FBQyxDQUFDO0FBb0M3SCw4R0FBOEc7QUFDOUcscUVBQXFFO0FBQ3JFLGlJQUFpSTtBQUNqSSxnQkFBZ0I7QUFDaEIsdUJBQXVCO0FBQ3ZCLEtBQUs7QUFDTCxNQUFNLE9BQU8sMEJBQTBCO0lBb0VyQyxZQUFxQixPQUFrQztRQUFsQyxZQUFPLEdBQVAsT0FBTyxDQUEyQjtRQUNyRCxvRkFBb0Y7UUFDcEYsdUVBQXVFO1FBQ3ZFLElBQUksT0FBTyxFQUFFO1lBQ1gsMkdBQTJHO1lBQzNHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1lBQ3hDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUM7WUFDcEQsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7WUFDMUQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQztZQUNsRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxPQUFP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RCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDO1lBQ2xELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUM7U0FDbkQ7UUFFRCxpREFBaUQ7UUFDakQsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2xGLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsRixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDaEYsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2xGLENBQUM7Q0EwQkYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RTdWNjZXNzTG9naW5IYW5kbGVyIH0gZnJvbSAnLi9oYW5kbGVyL2Fic3RyYWN0LXN1Y2Nlc3MtbG9naW4uaGFuZGxlcic7XG5pbXBvcnQgeyBGYWlsdXJlTG9naW5IYW5kbGVySW50ZXJmYWNlIH0gZnJvbSAnLi9oYW5kbGVyL2ZhaWx1cmUtbG9naW4taGFuZGxlci1pbnRlcmZhY2UnO1xuXG5cblxuLy8gVG9rZW4gcGVybWV0dGFudCBkJ2luamVjdGVyIGxlIHN1Y2Nlc3NfaGFuZGxlclxuZXhwb3J0IGNvbnN0IFBSSVNNRV9TVUNDRVNTX0xPR0lOX0hBTkRMRVIgPSBuZXcgSW5qZWN0aW9uVG9rZW48QWJzdHJhY3RTdWNjZXNzTG9naW5IYW5kbGVyPignUFJJU01FX1NVQ0NFU1NfTE9HSU5fSEFORExFUicpO1xuXG4vLyBUb2tlbiBwZXJtZXR0YW50IGQnaW5qZWN0ZXIgbGUgc3VjY2Vzc19oYW5kbGVyXG5leHBvcnQgY29uc3QgUFJJU01FX0ZBSUxVUkVfTE9HSU5fSEFORExFUiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxGYWlsdXJlTG9naW5IYW5kbGVySW50ZXJmYWNlPignUFJJU01FX0ZBSUxVUkVfTE9HSU5fSEFORExFUicpO1xuXG4vLyBUb2tlbiBwZXJtZXR0YW50IGRlIGZhaXJlIGwnaW5qZWN0aW9uIGRhbnMgUHJpc21lQW5ndWxhckNvbmZpZ3VyYXRpb25cbi8vIGV4cG9ydCBjb25zdCBDT05GSUdfRlJPTV9BUFAgPSBuZXcgSW5qZWN0aW9uVG9rZW48RW52aXJvbm1lbnRDb25maWdGcm9tQXBwPihcbi8vICAgJ0Vudmlyb25tZW50Q29uZmlnRnJvbUFwcCdcbi8vICk7XG5cbi8vIEludGVyZmFjZSBwZXJtZXR0YW50IGTDqWNyaXJlIGxlcyBwYXJhbcOodHJlcyBtb2RpZmlhYmxlcyBwYXIgbCdhcHBsaWNhdGlvbiBhcHBlbGxhbnRlXG4vLyBBIG5lIHBhcyB1dGlsaXNlciBkYW5zIGxhIGxpYnJhaXJpZSBwcmlzbWUgLS0+IHV0aWxpc2VyIHBsdXTDtHQgUHJpc2VBbmd1bGFyQ29uZmlndXJhdGlvblxuLy8gTGUgYnV0IMOpdGFudCBxdWUgbGEgY2xhc3NlIGRlIHBhcmFtw6h0cmUgZGUgbCdhcHBsaWNhdGlvbiBhcHBlbGFudGUgbmUgc29pdCBwYXMgZGlyZWN0ZW1lbnQgdXRpbGlzw6llIGRhbnMgbGFcbi8vIGxpYnJhaXJpZSBwcmlzbWUuIE9uIGZhaXQgZG9uYyB1bmUgY29waWUgZGUgY2V0dGUgY29uZmlndXJhdGlvbiBkYW5zIGxhIGNsYXNzZSBkZSBjb25maWd1cmF0aW9uXG4vLyBwcm9wcmUgw6AgUHJpc21lIChQcmlzZUFuZ3VsYXJDb25maWd1cmF0aW9uKVxuZXhwb3J0IGludGVyZmFjZSBFbnZpcm9ubWVudENvbmZpZ0Zyb21BcHAge1xuICAgIHByaXNtZVVybEJhc2VFbmRwb2ludD86IHN0cmluZztcbiAgICBwcmlzbWVBdXRoekVuZHBvaW50Pzogc3RyaW5nO1xuICAgIHByaXNtZVRva2VuRW5kcG9pbnQ/OiBzdHJpbmc7XG4gICAgcHJpc21lS2V5c0VuZHBvaW50Pzogc3RyaW5nO1xuICAgIHByaXNtZVVzZXJFbmRwb2ludD86IHN0cmluZztcbiAgICBwcmlzbWVJc3M6IHN0cmluZztcbiAgICBwcmlzbWVTY29wZUJhY2s6IHN0cmluZztcbiAgICBwcmlzbWVDbGllbnRTZWNyZXQ6IHN0cmluZztcbiAgICBwcmlzbWVDbGllbnRJZDogc3RyaW5nO1xuICAgIHByaXNtZUNvZGVBcHA6IHN0cmluZztcbiAgICBwcmlzbWVTY29wZUZyb250OiBzdHJpbmc7XG4gICAgYXBwbGljYXRpb25Vcmk6IHN0cmluZztcbiAgICBwcmlzbWVSZWZyZXNoVG9rZW5zSW50ZXJ2YWw6IG51bWJlcjtcbiAgICBpRnJhbWVSZW5vdXZlbGxlbWVudDogc3RyaW5nO1xuICAgIHBhZ2VBcHJlc0Nvbm5leGlvbj86IHN0cmluZztcbiAgICBjaGFyZ2VyVXNlckluZm9zRnJvbnQ6IGJvb2xlYW47XG4gICAgY2hhcmdlclVzZXJJbmZvc0JhY2s6IGJvb2xlYW47XG4gICAgamV0b25SZWFkeVRvcGljOiBzdHJpbmc7XG4gICAgamV0b25NZXNzYWdlVG9waWM6IHN0cmluZztcbiAgICB3YWl0V2ViTWVzc2FnZVVSTEZyYWdtZW50OiBzdHJpbmc7XG4gfVxuXG5cbi8vIENsYXNzZSBwZXJtZXR0YW50IGRlIHRyYXZhaWxsZXIgc3VyIGxlcyBwYXJhbcOodHJlcyBmb3VybmllIHBhciBsJ2FwcGxpY2F0aW9uIGFmaW4gZCdham91dGVyIGR1IGNvbXBvcnRlbWVudFxuLy8gQ2V0dGUgY2xhc3NlIGVzdCBsYSBjb25maWd1cmF0aW9uIFwiaW50ZXJuZVwiIGRlIGxhIGxpYnJhaXJpZSBwcmlzbWVcbi8vIEEgbGEgY29uc3RyY3V0aW9uIG9uIGNvcGllIGwnZW5zZW1ibGUgZGVzIHBhcmFtw6h0cmVzIMOpY3JpdHMgZGFucyBsYSBjb25maWd1cmF0aW9uIGRlIGwnYXBwbGljYXRpb24gYXBwZWxhbnRlIGRhbnMgY2V0dGUgY2xhc3NlXG4vLyBASW5qZWN0YWJsZSh7XG4vLyAgIHByb3ZpZGVkSW46ICdyb290J1xuLy8gfSlcbmV4cG9ydCBjbGFzcyBQcmlzbWVBbmd1bGFyQ29uZmlndXJhdGlvbiBpbXBsZW1lbnRzIEVudmlyb25tZW50Q29uZmlnRnJvbUFwcCB7XG5cbiAgcHJpc21lVXJsQmFzZUVuZHBvaW50OiBzdHJpbmc7XG4gIHByaXNtZUF1dGh6RW5kcG9pbnQ6IHN0cmluZztcbiAgcHJpc21lVG9rZW5FbmRwb2ludDogc3RyaW5nO1xuICBwcmlzbWVLZXlzRW5kcG9pbnQ6IHN0cmluZztcbiAgcHJpc21lVXNlckVuZHBvaW50OiBzdHJpbmc7XG4gIHByaXNtZUlzczogc3RyaW5nO1xuICBwcmlzbWVTY29wZUJhY2s6IHN0cmluZztcbiAgcHJpc21lQ2xpZW50U2VjcmV0OiBzdHJpbmc7XG4gIHByaXNtZUNsaWVudElkOiBzdHJpbmc7XG4gIHByaXNtZUNvZGVBcHA6IHN0cmluZztcbiAgcHJpc21lU2NvcGVGcm9udDogc3RyaW5nO1xuICBhcHBsaWNhdGlvblVyaTogc3RyaW5nO1xuICBwcmlzbWVSZWZyZXNoVG9rZW5zSW50ZXJ2YWw6IG51bWJlcjtcbiAgaUZyYW1lUmVub3V2ZWxsZW1lbnQ6IHN0cmluZztcbiAgcGFnZUFwcmVzQ29ubmV4aW9uOiBzdHJpbmc7XG4gIGNoYXJnZXJVc2VySW5mb3NGcm9udDogYm9vbGVhbjtcbiAgY2hhcmdlclVzZXJJbmZvc0JhY2s6IGJvb2xlYW47XG4gIGpldG9uUmVhZHlUb3BpYzogc3RyaW5nO1xuICBqZXRvbk1lc3NhZ2VUb3BpYzogc3RyaW5nO1xuICB3YWl0V2ViTWVzc2FnZVVSTEZyYWdtZW50OiBzdHJpbmc7XG5cbiAgcmVwbGFjZUlmTnVsbChwYXJhbWV0ZXJUb1Rlc3QsIHJlcGxhY2VCeSkge1xuICAgIGlmIChwYXJhbWV0ZXJUb1Rlc3QgPT0gbnVsbCApIHtcbiAgICAgIHJldHVybiByZXBsYWNlQnk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBwYXJhbWV0ZXJUb1Rlc3Q7XG4gICAgfVxuICB9XG5cbiAgYWRkSHR0cElzTmVjZXNzYXJ5KHBhcmFtZXRlclRvVGVzdCkge1xuICAgIGlmIChwYXJhbWV0ZXJUb1Rlc3Quc3RhcnRzV2l0aCgnaHR0cCcpICkge1xuICAgICAgcmV0dXJuIHBhcmFtZXRlclRvVGVzdDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICdodHRwOi8vJyArIHBhcmFtZXRlclRvVGVzdDtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEFmZmVjdGUgbGVzIGVuZFBvaW50cyDDoCBwYXJ0aXIgZGUgcHJpc21lVXJsQmFzZUVuZHBvaW50XG4gICAqIFbDqXJpZmllIHNpIGxlcyB2YWxldXJzIHNvbnQgYmllbiBhZmZlY3TDqWVzXG4gICAqIEBwYXJhbSBsZW5ndGggTG9uZ3VldXJcbiAgICovXG4gIHNldFByaXNtZUVuZHBvaW50cyhjb25mOiBFbnZpcm9ubWVudENvbmZpZ0Zyb21BcHApIHtcbiAgICBpZiAoY29uZi5wcmlzbWVVcmxCYXNlRW5kcG9pbnQgIT0gbnVsbCkge1xuICAgICAgdGhpcy5wcmlzbWVVcmxCYXNlRW5kcG9pbnQgPSBjb25mLnByaXNtZVVybEJhc2VFbmRwb2ludDtcbiAgICAgIC8vIE9uIGVubGV2ZSBsZSAvIGEgbGEgZmluIHNpIGlsIGVzdCBwcsOpc2VudFxuICAgICAgaWYgKHRoaXMucHJpc21lVXJsQmFzZUVuZHBvaW50LmVuZHNXaXRoKCcvJykpIHtcbiAgICAgICAgdGhpcy5wcmlzbWVVcmxCYXNlRW5kcG9pbnQgPSB0aGlzLnByaXNtZVVybEJhc2VFbmRwb2ludC5zbGljZSgwLCB0aGlzLnByaXNtZVVybEJhc2VFbmRwb2ludC5sZW5ndGggLSAxKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucHJpc21lQXV0aHpFbmRwb2ludCA9IHRoaXMucmVwbGFjZUlmTnVsbChjb25mLnByaXNtZUF1dGh6RW5kcG9pbnQsIHRoaXMucHJpc21lVXJsQmFzZUVuZHBvaW50ICsgJy9zZWN1cml0eS92MS9wc3MvYXV0aHonKTtcbiAgICAgIHRoaXMucHJpc21lVG9rZW5FbmRwb2ludCA9IHRoaXMucmVwbGFjZUlmTnVsbChjb25mLnByaXNtZVRva2VuRW5kcG9pbnQsIHRoaXMucHJpc21lVXJsQmFzZUVuZHBvaW50ICsgJy9zZWN1cml0eS92MS9wc3MvdG9rZW4nKTtcbiAgICAgIHRoaXMucHJpc21lS2V5c0VuZHBvaW50ID0gdGhpcy5yZXBsYWNlSWZOdWxsKGNvbmYucHJpc21lS2V5c0VuZHBvaW50LCB0aGlzLnByaXNtZVVybEJhc2VFbmRwb2ludCArICcvc2VjdXJpdHkvdjEvcHNzL2p3a3MvcHVibGljJyk7XG4gICAgICB0aGlzLnByaXNtZVVzZXJFbmRwb2ludCA9IHRoaXMucmVwbGFjZUlmTnVsbChjb25mLnByaXNtZVVzZXJFbmRwb2ludCwgdGhpcy5wcmlzbWVVcmxCYXNlRW5kcG9pbnQgKyAnL3NlY3VyaXR5L3YxL3Bzcy91c2VyLWluZm8nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcmlzbWVBdXRoekVuZHBvaW50ID0gY29uZi5wcmlzbWVBdXRoekVuZHBvaW50O1xuICAgICAgdGhpcy5wcmlzbWVUb2tlbkVuZHBvaW50ID0gY29uZi5wcmlzbWVUb2tlbkVuZHBvaW50O1xuICAgICAgdGhpcy5wcmlzbWVLZXlzRW5kcG9pbnQgPSBjb25mLnByaXNtZUtleXNFbmRwb2ludDtcbiAgICAgIHRoaXMucHJpc21lVXNlckVuZHBvaW50ID0gY29uZi5wcmlzbWVVc2VyRW5kcG9pbnQ7XG4gICAgfVxuXG4gICAgLy8gT24gcmVtcGxhY2UgbGVzIC8vIHBhciBkZXMgLyBjYXIgcG9zZSBwcm9ibMOobWVcbiAgICB0aGlzLnByaXNtZUF1dGh6RW5kcG9pbnQgPSB0aGlzLnByaXNtZUF1dGh6RW5kcG9pbnQucmVwbGFjZSgvKFteOl1cXC8pXFwvKy9nLCAnJDEnKTtcbiAgICB0aGlzLnByaXNtZVRva2VuRW5kcG9pbnQgPSB0aGlzLnByaXNtZVRva2VuRW5kcG9pbnQucmVwbGFjZSgvKFteOl1cXC8pXFwvKy9nLCAnJDEnKTtcbiAgICB0aGlzLnByaXNtZUtleXNFbmRwb2ludCA9IHRoaXMucHJpc21lS2V5c0VuZHBvaW50LnJlcGxhY2UoLyhbXjpdXFwvKVxcLysvZywgJyQxJyk7XG4gICAgdGhpcy5wcmlzbWVVc2VyRW5kcG9pbnQgPSB0aGlzLnByaXNtZVVzZXJFbmRwb2ludC5yZXBsYWNlKC8oW146XVxcLylcXC8rL2csICckMScpO1xuICB9XG5cbiAgY29uc3RydWN0b3IgKHByaXZhdGUgYXBwY29uZj86IEVudmlyb25tZW50Q29uZmlnRnJvbUFwcCkge1xuICAgIC8vIFNpIGFwcENvbmYgbidlc3QgcGFzIG51bGwsIGFsb3JzIG9uIGNvbnRydWl0IGxhIGNvbmZpZ3VyYXRpb24gYSBwYXJ0aXIgZGUgYXBwQ29uZlxuICAgIC8vIFNpbm9uLCBsYSBjbGFzc2UgYXBwZWxhbnRlIGRvaXQgZm91cm5pciBsZXMgaW5mb3JtYXRpb25zIFwidW5lIMOgIHVuZVwiXG4gICAgaWYgKGFwcGNvbmYpIHtcbiAgICAgIC8vIFbDqXJpZmljYXRpb24gZGVzIHVybHMgZGVzIEVucG9pbnRzIGV0IGFmZmVjdGF0aW9uIGRlcyBlbmRwb2ludHMgw6AgcGFydGlyIGRlIHByaXNtZVVybEJhc2VFbmRwb2ludHMgKHNpIClcbiAgICAgIHRoaXMuc2V0UHJpc21lRW5kcG9pbnRzKGFwcGNvbmYpO1xuICAgICAgdGhpcy5wcmlzbWVJc3MgPSB0aGlzLmFwcGNvbmYucHJpc21lSXNzO1xuICAgICAgdGhpcy5wcmlzbWVTY29wZUJhY2sgPSB0aGlzLmFwcGNvbmYucHJpc21lU2NvcGVCYWNrO1xuICAgICAgdGhpcy5wcmlzbWVDbGllbnRTZWNyZXQgPSB0aGlzLmFwcGNvbmYucHJpc21lQ2xpZW50U2VjcmV0O1xuICAgICAgdGhpcy5wcmlzbWVDbGllbnRJZCA9IHRoaXMuYXBwY29uZi5wcmlzbWVDbGllbnRJZDtcbiAgICAgIHRoaXMucHJpc21lQ29kZUFwcCA9IHRoaXMuYXBwY29uZi5wcmlzbWVDb2RlQXBwO1xuICAgICAgdGhpcy5wcmlzbWVTY29wZUZyb250ID0gdGhpcy5hcHBjb25mLnByaXNtZVNjb3BlRnJvbnQ7XG4gICAgICB0aGlzLmFwcGxpY2F0aW9uVXJpID0gdGhpcy5hZGRIdHRwSXNOZWNlc3NhcnkodGhpcy5hcHBjb25mLmFwcGxpY2F0aW9uVXJpKTtcbiAgICAgIHRoaXMucHJpc21lUmVmcmVzaFRva2Vuc0ludGVydmFsID0gdGhpcy5hcHBjb25mLnByaXNtZVJlZnJlc2hUb2tlbnNJbnRlcnZhbDtcbiAgICAgIHRoaXMuaUZyYW1lUmVub3V2ZWxsZW1lbnQgPSB0aGlzLmFwcGNvbmYuaUZyYW1lUmVub3V2ZWxsZW1lbnQ7XG4gICAgICB0aGlzLnBhZ2VBcHJlc0Nvbm5leGlvbiA9IHRoaXMuYXBwY29uZi5wYWdlQXByZXNDb25uZXhpb247XG4gICAgICB0aGlzLmNoYXJnZXJVc2VySW5mb3NCYWNrID0gdGhpcy5hcHBjb25mLmNoYXJnZXJVc2VySW5mb3NCYWNrO1xuICAgICAgdGhpcy5jaGFyZ2VyVXNlckluZm9zRnJvbnQgPSB0aGlzLmFwcGNvbmYuY2hhcmdlclVzZXJJbmZvc0Zyb250O1xuICAgICAgdGhpcy5qZXRvblJlYWR5VG9waWMgPSB0aGlzLmFwcGNvbmYuamV0b25SZWFkeVRvcGljO1xuICAgICAgdGhpcy5qZXRvbk1lc3NhZ2VUb3BpYyA9IHRoaXMuYXBwY29uZi5qZXRvbk1lc3NhZ2VUb3BpYztcbiAgICAgIHRoaXMud2FpdFdlYk1lc3NhZ2VVUkxGcmFnbWVudCA9IHRoaXMuYXBwY29uZi53YWl0V2ViTWVzc2FnZVVSTEZyYWdtZW50O1xuICAgIH1cbiAgfVxuXG59XG4iXX0=