import { CommunicationSPAServiceFactory } from '@acoss/communication-spa-core/dist/main/CommunicationSPAService';
import { Inject, InjectionToken, NgModule, Optional, SkipSelf } from '@angular/core';
import * as i0 from "@angular/core";
export const APP_NAME_VALUE_HOLDER = new InjectionToken('AppNameHolder');
export class CommunicationSPAModule {
    // Constructeur qui permet d'initier l'implémentation TS avec le Title de la WebApp Angular
    constructor(appName, parentModule) {
        if (parentModule) {
            throw new Error('CommunicationSPAModule is already loaded. Import it in the AppModule only');
        }
        this.myService = CommunicationSPAServiceFactory.getCommunicationSPAService(appName);
    }
    static forRoot(appName) {
        return {
            ngModule: CommunicationSPAModule,
            providers: [
                { provide: APP_NAME_VALUE_HOLDER, useValue: appName }
            ]
        };
    }
    /**
     * Méthode à appeler une fois les handlers enregistrés afin d'activer la communication
     * La méthode aura pour effet de débloquer l'envoi des messages d'init par le parent
     */
    applicationReadyActivateCommunication() {
        this.myService.applicationReadyActivateCommunication();
    }
    /**
     * Retourne l'identifiant unique du service de messagerie (= identifiant émetteur)
     * @returns UUID du compposant de messagerie
     */
    getUUID() {
        return this.myService.getUUID();
    }
    /**
     * Ajout d'un composant enfant de communication inter IHM
     * Permet d'ouvrir le canal de communication via le Handshake
     * @param componentWindow Composant HTML qui sera utilisé pour réaliser la communication
     * @param handshakeTimeoutMS Délai d'attente de résolution du handshake avant levée d'une erreur
     * @param timeoutCallback Fonction callback appelé en cas de levée du timeout
     * @returns UUID du composant enfant (vision parent != uuid vision enfant)
     */
    addChildComponent(componentWindow, handshakeTimeoutMS, timeoutCallback) {
        return this.myService.addChildComponent(componentWindow, handshakeTimeoutMS, timeoutCallback);
    }
    /**
     * Recherche de l'UUID réel (!vision parent) ayant l'UUID enfant fourni (vision parent)
     *
     * @param componentUUID UUID local du composant
     * @returns UUID réel du composant s'il est connu (= handshake realisé et enfant de niveau 1)
     */
    getChildToRealUUID(componentUUID) {
        return this.myService.getChildToRealUUID(componentUUID);
    }
    /**
     * Recherche de l'UUID enfant (vision parent) ayant l'UUID réel (!vision parent) fourni
     *
     * @param realUUID UUID réel du composant dont on souhaite rechercher l'UUID enfant (du composant local)
     * @returns UUID enfant du composant s'il est connu (= handshake realisé et enfant de niveau 1)
     */
    getRealToChildUUID(realUUID) {
        return this.myService.getRealToChildUUID(realUUID);
    }
    /**
     * Suppression d'un composant enfant
     * @param componentUUID UUID du composant enfant à supprimer
     */
    removeChildComponent(componentUUID) {
        this.myService.removeChildComponent(componentUUID);
    }
    /**
     * Suppression de tous les composants et souscriptions enregistrées
     */
    destroy() {
        return this.myService.destroy();
    }
    /**
     * Souscription à un type de message
     *
     * La fonction est activiée à reception d'un message si le namespace ET le topic matchent
     *
     * @param namespaceRegEx RegEx de match sur le namespace
     * @param topicRegEx RegEx de match sur le topic
     * @param handlerFunction Fonction qui sera déclanchée sur match namespaceRegEx ET topicRegEx
     * @returns UUID de la souscription
     */
    subscribe(namespaceRegEx, topicRegEx, handlerFunction) {
        return this.myService.subscribe(namespaceRegEx, topicRegEx, handlerFunction);
    }
    /**
     * Suppression d'une souscription
     * @param observerUUID UUID de la souscription à supprimer
     */
    unsubscribe(observerUUID) {
        return this.myService.unsubscribe(observerUUID);
    }
    /**
     * Suppression de toutes les souscriptions
     */
    unsubscribeAll() {
        return this.myService.unsubscribeAll();
    }
    /**
     * Envoi d'un message de type INIT, il est garanti que ces messages ne seront tranmis qu'une fois le
     * handshake finalisé avec le composant IHM enfant
     *
     * (Seul les messages init ont cette particularité, l'ensemble des autres messages sont transmis directement et ne seront pas
     * reçus sur le composant n'a pas finalisé son chargement et mis en place les handlers d'évènements)
     *
     * @param namespace namespace du message
     * @param topic topic du message
     * @param payload objet fonctionnel/métier qui sera transmis
     * @param componentUUID UUID du composant IHM à qui envoyer le message
     */
    sendChildInitMessage(namespace, topic, payload, componentUUID) {
        return this.myService.sendChildInitMessage(namespace, topic, payload, componentUUID);
    }
    /**
     * Envoi d'un message de réponse à un message émis.
     * La méthode nécessite de connaitre le MessageDTO et sera donc uniquement appelable via un handler de communication Applicatif
     * @param namespace namespace du message
     * @param topic topic du message
     * @param payload objet fonctionnel/métier qui sera transmis
     * @param originMessageObject Message d'origine entrainant la réponse
     */
    sendReplyMessage(namespace, topic, payload, originMessageObject) {
        return this.myService.sendReplyMessage(namespace, topic, payload, originMessageObject);
    }
    /**
     * Envoi d'un message BROADCAST, qui sera transmis à tous les composants IHM enregistrés
     * (tous les parents et tous les enfants...)
     * Les messages seront traités sous forme de message CHILDS
     *
     * @param namespace namespace du message
     * @param topic topic du message
     * @param payload objet fonctionnel/métier qui sera transmis
     */
    sendBroadcastMessage(namespace, topic, payload) {
        return this.myService.sendBroadcastMessage(namespace, topic, payload);
    }
    /**
     * Envoi d'un message CHILDS, qui sera transmis à tous les composants enfant IHM enregistrés
     * @param namespace namespace du message
     * @param topic topic du message
     * @param payload objet fonctionnel/métier qui sera transmis
     */
    sendChildrenMessage(namespace, topic, payload) {
        return this.myService.sendChildrenMessage(namespace, topic, payload);
    }
    /**
     * Envoi d'un message DIRECT à un enfant spécifique
     * @param namespace namespace du message
     * @param topic topic du message
     * @param payload objet fonctionnel/métier qui sera transmis
     * @param componentUUID UUID du composant enfant auquel on souhaite envoyer le message
     */
    sendChildMessage(namespace, topic, payload, componentUUID) {
        return this.myService.sendChildMessage(namespace, topic, payload, componentUUID);
    }
    /**
     * Envoi d'un message DIRECT au composant parent (s'il existe)
     * @param namespace namespace du message
     * @param topic topic du message
     * @param payload objet fonctionnel/métier qui sera transmis
     * @returns true si le message a été émis, false s'il n'y a pas d'application parent à qui envoyer un message
     */
    sendParentMessage(namespace, topic, payload) {
        return this.myService.sendParentMessage(namespace, topic, payload);
    }
}
/** @nocollapse */ CommunicationSPAModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.1.0", ngImport: i0, type: CommunicationSPAModule, deps: [{ token: APP_NAME_VALUE_HOLDER }, { token: CommunicationSPAModule, optional: true, skipSelf: true }], target: i0.ɵɵFactoryTarget.NgModule });
/** @nocollapse */ CommunicationSPAModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "14.0.0", version: "14.1.0", ngImport: i0, type: CommunicationSPAModule });
/** @nocollapse */ CommunicationSPAModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "14.1.0", ngImport: i0, type: CommunicationSPAModule });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.1.0", ngImport: i0, type: CommunicationSPAModule, decorators: [{
            type: NgModule,
            args: [{}]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [APP_NAME_VALUE_HOLDER]
                }] }, { type: CommunicationSPAModule, decorators: [{
                    type: Optional
                }, {
                    type: SkipSelf
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbXVuaWNhdGlvbi1zcGEubW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYWNvc3MvY29tbXVuaWNhdGlvbi1zcGEtYW5ndWxhci9zcmMvbGliL2NvbW11bmljYXRpb24tc3BhLm1vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxpRUFBaUUsQ0FBQztBQUNqSCxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBdUIsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBSTFHLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLElBQUksY0FBYyxDQUFTLGVBQWUsQ0FBQyxDQUFDO0FBSWpGLE1BQU0sT0FBTyxzQkFBc0I7SUFjakMsMkZBQTJGO0lBQzNGLFlBQWtELE9BQWUsRUFBMEIsWUFBb0M7UUFDN0gsSUFBSSxZQUFZLEVBQUU7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FDYiwyRUFBMkUsQ0FBQyxDQUFDO1NBQ2hGO1FBRUQsSUFBSSxDQUFDLFNBQVMsR0FBRyw4QkFBOEIsQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0RixDQUFDO0lBakJNLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBZTtRQUNuQyxPQUFPO1lBQ0wsUUFBUSxFQUFFLHNCQUFzQjtZQUNoQyxTQUFTLEVBQUU7Z0JBQ1QsRUFBQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBQzthQUNwRDtTQUNGLENBQUM7SUFDSixDQUFDO0lBWUQ7OztPQUdHO0lBQ0kscUNBQXFDO1FBQzFDLElBQUksQ0FBQyxTQUFTLENBQUMscUNBQXFDLEVBQUUsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksT0FBTztRQUNaLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJ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RSxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDckUsQ0FBQzs7c0lBcExVLHNCQUFzQixrQkFlTixxQkFBcUIsYUFBeUQsc0JBQXNCO3VJQWZwSCxzQkFBc0I7dUlBQXRCLHNCQUFzQjsyRkFBdEIsc0JBQXNCO2tCQUZsQyxRQUFRO21CQUFDLEVBQ1Q7OzBCQWdCcUIsTUFBTTsyQkFBQyxxQkFBcUI7OEJBQXlELHNCQUFzQjswQkFBM0QsUUFBUTs7MEJBQUksUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElDb21tdW5pY2F0aW9uU1BBU2VydmljZSwgTWVzc2FnZURUTywgTWVzc2FnZUhhbmRsZXJ9IGZyb20gJ0BhY29zcy9jb21tdW5pY2F0aW9uLXNwYS1jb3JlJztcbmltcG9ydCB7IENvbW11bmljYXRpb25TUEFTZXJ2aWNlRmFjdG9yeSB9IGZyb20gJ0BhY29zcy9jb21tdW5pY2F0aW9uLXNwYS1jb3JlL2Rpc3QvbWFpbi9Db21tdW5pY2F0aW9uU1BBU2VydmljZSc7XG5pbXBvcnQgeyBJbmplY3QsIEluamVjdGlvblRva2VuLCBNb2R1bGVXaXRoUHJvdmlkZXJzLCBOZ01vZHVsZSwgT3B0aW9uYWwsIFNraXBTZWxmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cblxuXG5leHBvcnTCoGNvbnN0wqBBUFBfTkFNRV9WQUxVRV9IT0xERVLCoD3CoG5ld8KgSW5qZWN0aW9uVG9rZW48c3RyaW5nPignQXBwTmFtZUhvbGRlcicpO1xuXG5ATmdNb2R1bGUoe1xufSlcbmV4cG9ydCBjbGFzcyBDb21tdW5pY2F0aW9uU1BBTW9kdWxlIGltcGxlbWVudHMgSUNvbW11bmljYXRpb25TUEFTZXJ2aWNlIHtcblxuICAvLyBMaWVuIHZlcnMgbCdpbXBsw6ltZW50YXRpb24gVFNcbiAgcHJpdmF0ZSBteVNlcnZpY2UhOiBJQ29tbXVuaWNhdGlvblNQQVNlcnZpY2U7XG5cbiAgcHVibGljIHN0YXRpYyBmb3JSb290KGFwcE5hbWU6IHN0cmluZyk6IE1vZHVsZVdpdGhQcm92aWRlcnM8Q29tbXVuaWNhdGlvblNQQU1vZHVsZT4ge1xuICAgIHJldHVybiB7XG4gICAgICBuZ01vZHVsZTogQ29tbXVuaWNhdGlvblNQQU1vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7cHJvdmlkZTogQVBQX05BTUVfVkFMVUVfSE9MREVSLCB1c2VWYWx1ZTogYXBwTmFtZX1cbiAgICAgIF1cbiAgICB9O1xuICB9XG5cbiAgLy8gQ29uc3RydWN0ZXVyIHF1aSBwZXJtZXQgZCdpbml0aWVyIGwnaW1wbMOpbWVudGF0aW9uIFRTIGF2ZWMgbGUgVGl0bGUgZGUgbGEgV2ViQXBwIEFuZ3VsYXJcbiAgcHVibGljIGNvbnN0cnVjdG9yKEBJbmplY3QoQVBQX05BTUVfVkFMVUVfSE9MREVSKSBhcHBOYW1lOiBzdHJpbmcsIEBPcHRpb25hbCgpIEBTa2lwU2VsZigpIHBhcmVudE1vZHVsZTogQ29tbXVuaWNhdGlvblNQQU1vZHVsZSkge1xuICAgIGlmIChwYXJlbnRNb2R1bGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0NvbW11bmljYXRpb25TUEFNb2R1bGUgaXMgYWxyZWFkeSBsb2FkZWQuIEltcG9ydCBpdCBpbiB0aGUgQXBwTW9kdWxlIG9ubHknKTtcbiAgICB9XG5cbiAgICB0aGlzLm15U2VydmljZSA9IENvbW11bmljYXRpb25TUEFTZXJ2aWNlRmFjdG9yeS5nZXRDb21tdW5pY2F0aW9uU1BBU2VydmljZShhcHBOYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNw6l0aG9kZSDDoCBhcHBlbGVyIHVuZSBmb2lzIGxlcyBoYW5kbGVycyBlbnJlZ2lzdHLDqXMgYWZpbiBkJ2FjdGl2ZXIgbGEgY29tbXVuaWNhdGlvblxuICAgKiBMYSBtw6l0aG9kZSBhdXJhIHBvdXIgZWZmZXQgZGUgZMOpYmxvcXVlciBsJ2Vudm9pIGRlcyBtZXNzYWdlcyBkJ2luaXQgcGFyIGxlIHBhcmVudFxuICAgKi9cbiAgcHVibGljIGFwcGxpY2F0aW9uUmVhZHlBY3RpdmF0ZUNvbW11bmljYXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy5teVNlcnZpY2UuYXBwbGljYXRpb25SZWFkeUFjdGl2YXRlQ29tbXVuaWNhdGlvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldG91cm5lIGwnaWRlbnRpZmlhbnQgdW5pcXVlIGR1IHNlcnZpY2UgZGUgbWVzc2FnZXJpZSAoPSBpZGVudGlmaWFudCDDqW1ldHRldXIpXG4gICAqIEByZXR1cm5zIFVVSUQgZHUgY29tcHBvc2FudCBkZSBtZXNzYWdlcmllXG4gICAqL1xuICBwdWJsaWMgZ2V0VVVJRCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS5nZXRVVUlEKCk7XG4gIH1cblxuICAvKipcbiAgICogQWpvdXQgZCd1biBjb21wb3NhbnQgZW5mYW50IGRlIGNvbW11bmljYXRpb24gaW50ZXIgSUhNXG4gICAqIFBlcm1ldCBkJ291dnJpciBsZSBjYW5hbCBkZSBjb21tdW5pY2F0aW9uIHZpYSBsZSBIYW5kc2hha2VcbiAgICogQHBhcmFtIGNvbXBvbmVudFdpbmRvdyBDb21wb3NhbnQgSFRNTCBxdWkgc2VyYSB1dGlsaXPDqSBwb3VyIHLDqWFsaXNlciBsYSBjb21tdW5pY2F0aW9uXG4gICAqIEBwYXJhbSBoYW5kc2hha2VUaW1lb3V0TVMgRMOpbGFpIGQnYXR0ZW50ZSBkZSByw6lzb2x1dGlvbiBkdSBoYW5kc2hha2UgYXZhbnQgbGV2w6llIGQndW5lIGVycmV1clxuICAgKiBAcGFyYW0gdGltZW91dENhbGxiYWNrIEZvbmN0aW9uIGNhbGxiYWNrIGFwcGVsw6kgZW4gY2FzIGRlIGxldsOpZSBkdSB0aW1lb3V0XG4gICAqIEByZXR1cm5zIFVVSUQgZHUgY29tcG9zYW50IGVuZmFudCAodmlzaW9uIHBhcmVudCAhPSB1dWlkIHZpc2lvbiBlbmZhbnQpXG4gICAqL1xuICBwdWJsaWMgYWRkQ2hpbGRDb21wb25lbnQoY29tcG9uZW50V2luZG93OiBXaW5kb3csIGhhbmRzaGFrZVRpbWVvdXRNUzogbnVtYmVyLCB0aW1lb3V0Q2FsbGJhY2s6IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubXlTZXJ2aWNlLmFkZENoaWxkQ29tcG9uZW50KGNvbXBvbmVudFdpbmRvdywgaGFuZHNoYWtlVGltZW91dE1TLCB0aW1lb3V0Q2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY2hlcmNoZSBkZSBsJ1VVSUQgcsOpZWwgKCF2aXNpb24gcGFyZW50KSBheWFudCBsJ1VVSUQgZW5mYW50IGZvdXJuaSAodmlzaW9uIHBhcmVudClcbiAgICpcbiAgICogQHBhcmFtIGNvbXBvbmVudFVVSUQgVVVJRCBsb2NhbCBkdSBjb21wb3NhbnRcbiAgICogQHJldHVybnMgVVVJRCByw6llbCBkdSBjb21wb3NhbnQgcydpbCBlc3QgY29ubnUgKD0gaGFuZHNoYWtlIHJlYWxpc8OpIGV0IGVuZmFudCBkZSBuaXZlYXUgMSlcbiAgICovXG4gIHB1YmxpYyBnZXRDaGlsZFRvUmVhbFVVSUQoY29tcG9uZW50VVVJRDogc3RyaW5nKTogc3RyaW5nfHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMubXlTZXJ2aWNlLmdldENoaWxkVG9SZWFsVVVJRChjb21wb25lbnRVVUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNoZXJjaGUgZGUgbCdVVUlEIGVuZmFudCAodmlzaW9uIHBhcmVudCkgYXlhbnQgbCdVVUlEIHLDqWVsICghdmlzaW9uIHBhcmVudCkgZm91cm5pXG4gICAqXG4gICAqIEBwYXJhbSByZWFsVVVJRCBVVUlEIHLDqWVsIGR1IGNvbXBvc2FudCBkb250IG9uIHNvdWhhaXRlIHJlY2hlcmNoZXIgbCdVVUlEIGVuZmFudCAoZHUgY29tcG9zYW50IGxvY2FsKVxuICAgKiBAcmV0dXJucyBVVUlEIGVuZmFudCBkdSBjb21wb3NhbnQgcydpbCBlc3QgY29ubnUgKD0gaGFuZHNoYWtlIHJlYWxpc8OpIGV0IGVuZmFudCBkZSBuaXZlYXUgMSlcbiAgICovXG4gIHB1YmxpYyBnZXRSZWFsVG9DaGlsZFVVSUQocmVhbFVVSUQ6IHN0cmluZyk6IHN0cmluZ3x1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS5nZXRSZWFsVG9DaGlsZFVVSUQocmVhbFVVSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN1cHByZXNzaW9uIGQndW4gY29tcG9zYW50IGVuZmFudFxuICAgKiBAcGFyYW0gY29tcG9uZW50VVVJRCBVVUlEIGR1IGNvbXBvc2FudCBlbmZhbnQgw6Agc3VwcHJpbWVyXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlQ2hpbGRDb21wb25lbnQoY29tcG9uZW50VVVJRDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5teVNlcnZpY2UucmVtb3ZlQ2hpbGRDb21wb25lbnQoY29tcG9uZW50VVVJRCk7XG4gIH1cblxuICAvKipcbiAgICogU3VwcHJlc3Npb24gZGUgdG91cyBsZXMgY29tcG9zYW50cyBldCBzb3VzY3JpcHRpb25zIGVucmVnaXN0csOpZXNcbiAgICovXG4gIHB1YmxpYyBkZXN0cm95KCk6IHZvaWQge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS5kZXN0cm95KCk7XG4gIH1cblxuICAvKipcbiAgICogU291c2NyaXB0aW9uIMOgIHVuIHR5cGUgZGUgbWVzc2FnZVxuICAgKlxuICAgKiBMYSBmb25jdGlvbiBlc3QgYWN0aXZpw6llIMOgIHJlY2VwdGlvbiBkJ3VuIG1lc3NhZ2Ugc2kgbGUgbmFtZXNwYWNlIEVUIGxlIHRvcGljIG1hdGNoZW50XG4gICAqXG4gICAqIEBwYXJhbSBuYW1lc3BhY2VSZWdFeCBSZWdFeCBkZSBtYXRjaCBzdXIgbGUgbmFtZXNwYWNlXG4gICAqIEBwYXJhbSB0b3BpY1JlZ0V4IFJlZ0V4IGRlIG1hdGNoIHN1ciBsZSB0b3BpY1xuICAgKiBAcGFyYW0gaGFuZGxlckZ1bmN0aW9uIEZvbmN0aW9uIHF1aSBzZXJhIGTDqWNsYW5jaMOpZSBzdXIgbWF0Y2ggbmFtZXNwYWNlUmVnRXggRVQgdG9waWNSZWdFeFxuICAgKiBAcmV0dXJucyBVVUlEIGRlIGxhIHNvdXNjcmlwdGlvblxuICAgKi9cbiAgcHVibGljIHN1YnNjcmliZShuYW1lc3BhY2VSZWdFeDogc3RyaW5nLCB0b3BpY1JlZ0V4OiBzdHJpbmcsIGhhbmRsZXJGdW5jdGlvbjogTWVzc2FnZUhhbmRsZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS5zdWJzY3JpYmUobmFtZXNwYWNlUmVnRXgsIHRvcGljUmVnRXgsIGhhbmRsZXJGdW5jdGlvbik7XG4gIH1cbiAgLyoqXG4gICAqIFN1cHByZXNzaW9uIGQndW5lIHNvdXNjcmlwdGlvblxuICAgKiBAcGFyYW0gb2JzZXJ2ZXJVVUlEIFVVSUQgZGUgbGEgc291c2NyaXB0aW9uIMOgIHN1cHByaW1lclxuICAgKi9cbiAgcHVibGljIHVuc3Vic2NyaWJlKG9ic2VydmVyVVVJRDogc3RyaW5nKTogdm9pZCB7XG4gICAgcmV0dXJuIHRoaXMubXlTZXJ2aWNlLnVuc3Vic2NyaWJlKG9ic2VydmVyVVVJRCk7XG4gIH1cbiAgLyoqXG4gICAqIFN1cHByZXNzaW9uIGRlIHRvdXRlcyBsZXMgc291c2NyaXB0aW9uc1xuICAgKi9cbiAgcHVibGljIHVuc3Vic2NyaWJlQWxsKCk6IHZvaWQge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS51bnN1YnNjcmliZUFsbCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVudm9pIGQndW4gbWVzc2FnZSBkZSB0eXBlIElOSVQsIGlsIGVzdCBnYXJhbnRpIHF1ZSBjZXMgbWVzc2FnZXMgbmUgc2Vyb250IHRyYW5taXMgcXUndW5lIGZvaXMgbGVcbiAgICogaGFuZHNoYWtlIGZpbmFsaXPDqSBhdmVjIGxlIGNvbXBvc2FudCBJSE0gZW5mYW50XG4gICAqXG4gICAqIChTZXVsIGxlcyBtZXNzYWdlcyBpbml0IG9udCBjZXR0ZSBwYXJ0aWN1bGFyaXTDqSwgbCdlbnNlbWJsZSBkZXMgYXV0cmVzIG1lc3NhZ2VzIHNvbnQgdHJhbnNtaXMgZGlyZWN0ZW1lbnQgZXQgbmUgc2Vyb250IHBhc1xuICAgKiByZcOndXMgc3VyIGxlIGNvbXBvc2FudCBuJ2EgcGFzIGZpbmFsaXPDqSBzb24gY2hhcmdlbWVudCBldCBtaXMgZW4gcGxhY2UgbGVzIGhhbmRsZXJzIGQnw6l2w6huZW1lbnRzKVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZXNwYWNlIG5hbWVzcGFjZSBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSB0b3BpYyB0b3BpYyBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSBwYXlsb2FkIG9iamV0IGZvbmN0aW9ubmVsL23DqXRpZXIgcXVpIHNlcmEgdHJhbnNtaXNcbiAgICogQHBhcmFtIGNvbXBvbmVudFVVSUQgVVVJRCBkdSBjb21wb3NhbnQgSUhNIMOgIHF1aSBlbnZveWVyIGxlIG1lc3NhZ2VcbiAgICovXG4gIHB1YmxpYyBzZW5kQ2hpbGRJbml0TWVzc2FnZShuYW1lc3BhY2U6IHN0cmluZywgdG9waWM6IHN0cmluZywgcGF5bG9hZDogYW55IHwgdW5kZWZpbmVkLCBjb21wb25lbnRVVUlEOiBzdHJpbmcpOiB2b2lkIHtcbiAgICByZXR1cm4gdGhpcy5teVNlcnZpY2Uuc2VuZENoaWxkSW5pdE1lc3NhZ2UobmFtZXNwYWNlLCB0b3BpYywgcGF5bG9hZCwgY29tcG9uZW50VVVJRCk7XG4gIH1cbiAgLyoqXG4gICAqIEVudm9pIGQndW4gbWVzc2FnZSBkZSByw6lwb25zZSDDoCB1biBtZXNzYWdlIMOpbWlzLlxuICAgKiBMYSBtw6l0aG9kZSBuw6ljZXNzaXRlIGRlIGNvbm5haXRyZSBsZSBNZXNzYWdlRFRPIGV0IHNlcmEgZG9uYyB1bmlxdWVtZW50IGFwcGVsYWJsZSB2aWEgdW4gaGFuZGxlciBkZSBjb21tdW5pY2F0aW9uIEFwcGxpY2F0aWZcbiAgICogQHBhcmFtIG5hbWVzcGFjZSBuYW1lc3BhY2UgZHUgbWVzc2FnZVxuICAgKiBAcGFyYW0gdG9waWMgdG9waWMgZHUgbWVzc2FnZVxuICAgKiBAcGFyYW0gcGF5bG9hZCBvYmpldCBmb25jdGlvbm5lbC9tw6l0aWVyIHF1aSBzZXJhIHRyYW5zbWlzXG4gICAqIEBwYXJhbSBvcmlnaW5NZXNzYWdlT2JqZWN0IE1lc3NhZ2UgZCdvcmlnaW5lIGVudHJhaW5hbnQgbGEgcsOpcG9uc2VcbiAgICovXG4gIHB1YmxpYyBzZW5kUmVwbHlNZXNzYWdlKG5hbWVzcGFjZTogc3RyaW5nLCB0b3BpYzogc3RyaW5nLCBwYXlsb2FkOiBhbnkgfCB1bmRlZmluZWQsIG9yaWdpbk1lc3NhZ2VPYmplY3Q6IE1lc3NhZ2VEVE8pOiB2b2lkIHtcbiAgICByZXR1cm4gdGhpcy5teVNlcnZpY2Uuc2VuZFJlcGx5TWVzc2FnZShuYW1lc3BhY2UsIHRvcGljLCBwYXlsb2FkLCBvcmlnaW5NZXNzYWdlT2JqZWN0KTtcbiAgfVxuICAvKipcbiAgICogRW52b2kgZCd1biBtZXNzYWdlIEJST0FEQ0FTVCwgcXVpIHNlcmEgdHJhbnNtaXMgw6AgdG91cyBsZXMgY29tcG9zYW50cyBJSE0gZW5yZWdpc3Ryw6lzXG4gICAqICh0b3VzIGxlcyBwYXJlbnRzIGV0IHRvdXMgbGVzIGVuZmFudHMuLi4pXG4gICAqIExlcyBtZXNzYWdlcyBzZXJvbnQgdHJhaXTDqXMgc291cyBmb3JtZSBkZSBtZXNzYWdlIENISUxEU1xuICAgKlxuICAgKiBAcGFyYW0gbmFtZXNwYWNlIG5hbWVzcGFjZSBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSB0b3BpYyB0b3BpYyBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSBwYXlsb2FkIG9iamV0IGZvbmN0aW9ubmVsL23DqXRpZXIgcXVpIHNlcmEgdHJhbnNtaXNcbiAgICovXG4gIHB1YmxpYyBzZW5kQnJvYWRjYXN0TWVzc2FnZShuYW1lc3BhY2U6IHN0cmluZywgdG9waWM6IHN0cmluZywgcGF5bG9hZDogYW55IHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgcmV0dXJuIHRoaXMubXlTZXJ2aWNlLnNlbmRCcm9hZGNhc3RNZXNzYWdlKG5hbWVzcGFjZSwgdG9waWMsIHBheWxvYWQpO1xuICB9XG4gIC8qKlxuICAgKiBFbnZvaSBkJ3VuIG1lc3NhZ2UgQ0hJTERTLCBxdWkgc2VyYSB0cmFuc21pcyDDoCB0b3VzIGxlcyBjb21wb3NhbnRzIGVuZmFudCBJSE0gZW5yZWdpc3Ryw6lzXG4gICAqIEBwYXJhbSBuYW1lc3BhY2UgbmFtZXNwYWNlIGR1IG1lc3NhZ2VcbiAgICogQHBhcmFtIHRvcGljIHRvcGljIGR1IG1lc3NhZ2VcbiAgICogQHBhcmFtIHBheWxvYWQgb2JqZXQgZm9uY3Rpb25uZWwvbcOpdGllciBxdWkgc2VyYSB0cmFuc21pc1xuICAgKi9cbiAgcHVibGljIHNlbmRDaGlsZHJlbk1lc3NhZ2UobmFtZXNwYWNlOiBzdHJpbmcsIHRvcGljOiBzdHJpbmcsIHBheWxvYWQ6IGFueSB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS5zZW5kQ2hpbGRyZW5NZXNzYWdlKG5hbWVzcGFjZSwgdG9waWMsIHBheWxvYWQpO1xuICB9XG4gIC8qKlxuICAgKiBFbnZvaSBkJ3VuIG1lc3NhZ2UgRElSRUNUIMOgIHVuIGVuZmFudCBzcMOpY2lmaXF1ZVxuICAgKiBAcGFyYW0gbmFtZXNwYWNlIG5hbWVzcGFjZSBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSB0b3BpYyB0b3BpYyBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSBwYXlsb2FkIG9iamV0IGZvbmN0aW9ubmVsL23DqXRpZXIgcXVpIHNlcmEgdHJhbnNtaXNcbiAgICogQHBhcmFtIGNvbXBvbmVudFVVSUQgVVVJRCBkdSBjb21wb3NhbnQgZW5mYW50IGF1cXVlbCBvbiBzb3VoYWl0ZSBlbnZveWVyIGxlIG1lc3NhZ2VcbiAgICovXG4gIHB1YmxpYyBzZW5kQ2hpbGRNZXNzYWdlKG5hbWVzcGFjZTogc3RyaW5nLCB0b3BpYzogc3RyaW5nLCBwYXlsb2FkOiBhbnkgfCB1bmRlZmluZWQsIGNvbXBvbmVudFVVSUQ6IHN0cmluZyk6IHZvaWQge1xuICAgIHJldHVybiB0aGlzLm15U2VydmljZS5zZW5kQ2hpbGRNZXNzYWdlKG5hbWVzcGFjZSwgdG9waWMsIHBheWxvYWQsIGNvbXBvbmVudFVVSUQpO1xuICB9XG4gIC8qKlxuICAgKiBFbnZvaSBkJ3VuIG1lc3NhZ2UgRElSRUNUIGF1IGNvbXBvc2FudCBwYXJlbnQgKHMnaWwgZXhpc3RlKVxuICAgKiBAcGFyYW0gbmFtZXNwYWNlIG5hbWVzcGFjZSBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSB0b3BpYyB0b3BpYyBkdSBtZXNzYWdlXG4gICAqIEBwYXJhbSBwYXlsb2FkIG9iamV0IGZvbmN0aW9ubmVsL23DqXRpZXIgcXVpIHNlcmEgdHJhbnNtaXNcbiAgICogQHJldHVybnMgdHJ1ZSBzaSBsZSBtZXNzYWdlIGEgw6l0w6kgw6ltaXMsIGZhbHNlIHMnaWwgbid5IGEgcGFzIGQnYXBwbGljYXRpb24gcGFyZW50IMOgIHF1aSBlbnZveWVyIHVuIG1lc3NhZ2VcbiAgICovXG4gIHB1YmxpYyBzZW5kUGFyZW50TWVzc2FnZShuYW1lc3BhY2U6IHN0cmluZywgdG9waWM6IHN0cmluZywgcGF5bG9hZDogYW55IHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubXlTZXJ2aWNlLnNlbmRQYXJlbnRNZXNzYWdlKG5hbWVzcGFjZSwgdG9waWMsIHBheWxvYWQpO1xuICB9XG59XG4iXX0=